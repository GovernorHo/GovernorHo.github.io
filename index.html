<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8">
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>What To Eat Today?</title>
    <link rel="stylesheet" href="src/css/typo/typo.css">
    <link rel="stylesheet" href="src/css/GB-css3-wheel.css">
    <link rel="stylesheet" href="http://icono-49d6.kxcdn.com/icono.min.css">
    <style>
    	.wrapper{
    		padding:20px 40px;
    	}
    	.fork-github{
    		position: fixed;
    		right: -100px;
    		top: 45px;
    		z-index: 9999;
    		padding: 2px 100px;
    		font-size: 12px;
    		background-color: #444;
    		border: 1px solid #000;
    		-webkit-transform: rotate(45deg);
    			-ms-transform: rotate(45deg);
    				transform: rotate(45deg);
    		text-align: center;
    	}
    	.fork-github a{
    		color: #fff;
    	}

    </style>
  </head>
  <body ontouchstart>
    
	
	

	<div class="wrapper typo" id="wrapper">
		
		<h1>今天吃什么?</h1>


    <section class="gb-wheel-container" id="gbWheel">
        <div class="gb-wheel-content gb-wheel-run">
            <ul class="gb-wheel-line">
                
            </ul>

            <div class="gb-wheel-list">
                
            </div>
        </div>
        <a href="javascript:;" class="gb-wheel-btn" id="gbLottery">开始</a>     
    </section>

    </div>
    
    <div class="fork-github">
        <a href="javascript:void(0);">Powered by Heguannan</a>
    </div>



	</div>
	


    <script>
        (function() {

            // 奖品配置
            var awards = [
                    {'index': 0, 'text': '大麻鱼' , 'name': 'icono-cup'},
                    {'index': 1, 'text': '负一层' , 'name': 'icono-cup'},
                    {'index': 2, 'text': '新奥' , 'name': 'icono-cup'},
                    {'index': 3, 'text': '酱骨' , 'name': 'icono-cup'},
                    {'index': 4, 'text': '地铁米线' , 'name': 'icono-cup'},
                    {'index': 5, 'text': '他二哥' , 'name': 'icono-cup'},
                    {'index': 6, 'text': '地理所' , 'name': 'icono-cup'},
                    {'index': 7, 'text': '肉饼' , 'name': 'icono-cup'}
                ],
                len = awards.length,
                turnNum = 1 / len;  // 文字旋转 turn 值

            var gbWheel = $('gbWheel'),
                lineList = gbWheel.querySelector('ul.gb-wheel-line'),
                itemList = gbWheel.querySelector('.gb-wheel-list'),
                lineListHtml = [],
                itemListHtml = [];

            var transform = preTransform();

            awards.forEach(function(v, i, a) {
                // 分隔线
                lineListHtml.push('<li class="gb-wheel-litem" style="' + transform + ': rotate('+ (i * turnNum + turnNum / 2) +'turn)"></li>');

                // 奖项
                itemListHtml.push('<div class="gb-wheel-item">');
                itemListHtml.push('<div class="gb-wheel-icontent" style="' + transform + ': rotate('+ (i * turnNum) +'turn)">');
                itemListHtml.push('<p class="gb-wheel-iicon">');
                itemListHtml.push('<img src="src/images/food.png" width="30px"></img>');
                itemListHtml.push('</p>');
                itemListHtml.push('<p class="gb-wheel-itext">');
                itemListHtml.push(v.text);
                itemListHtml.push('</p>');
                itemListHtml.push('</div>');
                itemListHtml.push('</div>');
            });           

            lineList.innerHTML = lineListHtml.join('');
            itemList.innerHTML = itemListHtml.join('');

            function $(id) {
                return document.getElementById(id);
            };

            every = 360 / len
            // 旋转
            var i = 0;
            $('gbLottery').onclick = function() {
                i++;
                //alert(Math.random())
                rand_rot= Math.round(Math.random() * len) * every
                gbWheel.querySelector('.gb-wheel-content').style[transform] = 'rotate('+ (i * 2520 + rand_rot) +'deg)';  
            }

            // console.log(preTransform());

            // transform兼容
            function preTransform() {
                var cssPrefix,
                vendors = {
                  '': '',
                  Webkit: 'webkit',
                  Moz: '',
                  O: 'o',
                  ms: 'ms'
                },
                testEle = document.createElement('p'),
                cssSupport = {};

                 // 嗅探特性
                Object.keys(vendors).some(function(vendor) {
                    if (testEle.style[vendor + (vendor ? 'T' : 't') + 'ransform'] !== undefined) {
                      cssPrefix = vendor ? '-' + vendor.toLowerCase() + '-' : '';
                      return true;
                    }
                });

              /**
               * [兼容CSS前缀]
               * @param  {[type]} name [description]
               * @return {[type]}      [description]
               */
              function normalizeCss(name) {
                name = name.toLowerCase();
                return cssPrefix ? cssPrefix + name : name;
              }

              cssSupport = {
                transform: normalizeCss('Transform'),
              }

              return cssSupport.transform;
            }

        }());

    </script>
  </body>
</html>